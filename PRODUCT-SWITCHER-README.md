# Product Switcher Implementation

This documentation site has been converted into a unified monorepo containing documentation for multiple products with a Product Switcher in the navbar.

## Architecture Overview

### Products Included
1. **Business App** - Customer acquisition and engagement platform
2. **Advertising Intelligence** - Unified PPC reporting
3. **AMPS** - Advertising Management Platform
4. **Local SEO** - Local rankings optimization
5. **Reputation Management** - Review management software
6. **Social Marketing** - Social media management
7. **WordPress Hosting** - Website hosting and management
8. **Yesware** - Sales engagement and email marketing

### Directory Structure

```
docusaurus/
├── docs/
│   ├── businessapp/     # Business App documentation
│   ├── adintel/         # Ad Intel documentation
│   ├── amps/            # AMPS documentation
│   ├── localseo/        # Local SEO documentation
│   ├── repman/          # Reputation Management documentation
│   ├── socialmarketing/ # Social Marketing documentation
│   ├── website/         # WordPress Hosting documentation
│   └── yesware/         # Yesware documentation
├── src/
│   ├── components/
│   │   ├── ProductSwitcher.tsx        # Product switcher dropdown component
│   │   └── ProductSwitcher.module.css # Styles for product switcher
│   ├── config/
│   │   └── products.ts                # Product metadata configuration
│   ├── contexts/
│   │   └── PermissionsContext.tsx     # Permission management context
│   └── theme/
│       ├── Root.tsx                   # App wrapper with PermissionsProvider
│       └── Navbar/                    # Custom navbar with ProductSwitcher
└── sidebars.ts                        # Multiple sidebar configurations
```

## Key Features

### 1. Product Switcher Component

Located at `/src/components/ProductSwitcher.tsx`, this component:
- Displays the current product with logo and name in the top-left of the navbar
- Opens a dropdown menu showing all accessible products
- Allows users to switch between products seamlessly
- Automatically detects the current product from the URL path

### 2. Permission System

Located at `/src/contexts/PermissionsContext.tsx`, this system:
- Manages which products a user can access
- Stores permissions in localStorage (easily replaceable with JWT, cookies, or API)
- Provides hooks: `usePermissions()` and `useCurrentProductAccess()`
- Filters which products appear in the ProductSwitcher dropdown

**Default Behavior:** All products are accessible by default. To restrict access:

```typescript
import { usePermissions } from '@site/src/contexts/PermissionsContext';

// In a component:
const { setAllowedProducts } = usePermissions();

// Grant access to specific products only
setAllowedProducts(['businessapp', 'adintel', 'localseo']);
```

**Integration with Authentication:**
To connect with your auth system, modify `PermissionsContext.tsx` to:
1. Fetch user permissions from your API on mount
2. Read permissions from JWT tokens
3. Use cookies or session storage
4. Call your auth service

### 3. Multi-Sidebar Setup

Each product has its own sidebar defined in `sidebars.ts`:

```typescript
const sidebars: SidebarsConfig = {
  businessappSidebar: [{ type: 'autogenerated', dirName: 'businessapp' }],
  adintelSidebar: [{ type: 'autogenerated', dirName: 'adintel' }],
  // ... other products
};
```

### 4. Product Configuration

Located at `/src/config/products.ts`, defines metadata for each product:

```typescript
export interface Product {
  id: string;           // Unique identifier
  name: string;         // Display name
  logo: string;         // Path to logo in /static/img/
  sidebarId: string;    // Reference to sidebar in sidebars.ts
  path: string;         // Base URL path (e.g., /businessapp/)
  tagline?: string;     // Optional description
}
```

To add a new product:
1. Add docs to `/docs/yourproduct/`
2. Add sidebar to `sidebars.ts`
3. Add product config to `products.ts`
4. Add navbar item to `docusaurus.config.ts` (with `className: 'navbar__item--hidden'`)
5. Copy logos to `/static/img/`

## URL Structure

- `/businessapp/` - Business App docs
- `/adintel/` - Ad Intel docs
- `/amps/` - AMPS docs
- `/localseo/` - Local SEO docs
- `/repman/` - Reputation Management docs
- `/socialmarketing/` - Social Marketing docs
- `/website/` - WordPress Hosting docs
- `/yesware/` - Yesware docs

The root path `/` redirects to `/businessapp/` by default.

## Customization

### Styling the Product Switcher

Edit `/src/components/ProductSwitcher.module.css` to customize:
- Dropdown appearance
- Button styling
- Animations and transitions
- Responsive breakpoints

### Changing Default Product

Edit `/src/pages/index.tsx` to change the default redirect:

```typescript
export default function Home(): JSX.Element {
  return <Redirect to="/your-default-product/" />;
}
```

### Filtering Sidebar Items by Permission

The permission system can be extended to filter specific sidebar items, not just whole products. Modify `/src/theme/DocSidebar/index.tsx` (create this file if needed) to add custom filtering logic.

## Development

### Running Locally

```bash
cd docusaurus
npm start
```

This starts the development server at `http://localhost:3000`.

### Building for Production

```bash
cd docusaurus
npm run build
npm run serve
```

## Deployment Notes

- All products are built together in a single deployment
- Search (Algolia) indexes all products
- Static assets are shared across all products
- Single domain serves all documentation

## Managing Permissions

### Scenario 1: All Products Visible (Default)
No configuration needed. All products appear in the switcher by default.

### Scenario 2: Restrict to Specific Products
Use localStorage:

```javascript
// In browser console or custom component:
localStorage.setItem('docs_allowed_products', JSON.stringify([
  'businessapp',
  'adintel',
  'localseo'
]));
```

### Scenario 3: API-Based Permissions
Modify `PermissionsContext.tsx` to fetch from your API:

```typescript
useEffect(() => {
  // Fetch user permissions from API
  fetch('/api/user/permissions')
    .then(res => res.json())
    .then(data => setAllowedProductsState(data.allowedProducts));
}, []);
```

### Scenario 4: JWT-Based Permissions
Parse JWT token and extract permissions:

```typescript
const token = getCookie('auth_token');
const decoded = jwtDecode(token);
setAllowedProductsState(decoded.allowedProducts);
```

## Troubleshooting

### Product Switcher Not Appearing
- Check that `PermissionsProvider` wraps the app in `/src/theme/Root.tsx`
- Verify products are configured in `/src/config/products.ts`
- Ensure logos exist in `/static/img/`

### Sidebar Not Switching
- Verify sidebar IDs in `products.ts` match `sidebars.ts`
- Check that navbar items in `docusaurus.config.ts` reference correct sidebarIds
- Ensure all navbar items have `className: 'navbar__item--hidden'`

### Build Errors
- Run `npm run build` to see detailed errors
- Check for broken links in `_category_.json` files
- Ensure all doc IDs include product prefix (e.g., `businessapp/ai/index`)

## Future Enhancements

Potential improvements:
1. **Server-Side Rendering** with permission checks
2. **Analytics Integration** to track product switching
3. **User Preferences** to remember last viewed product
4. **Search Filtering** by allowed products
5. **Multi-tenancy Support** with different product sets per customer
6. **Role-Based Access Control (RBAC)** with granular permissions

## Migration from Separate Repos

All documentation has been migrated from separate repos:
- `adintel-docs` → `/docs/adintel/`
- `amps-docs` → `/docs/amps/`
- `localseo-docs` → `/docs/localseo/`
- `repman-docs` → `/docs/repman/`
- `socialmarketing-docs` → `/docs/socialmarketing/`
- `website-docs` → `/docs/website/`
- `yesware-docs` → `/docs/yesware/`

Original repos can be archived or kept for reference.

